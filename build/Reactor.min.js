var Reactor=Reactor||{};!function(t,e){function n(t){return t.__realComponentInstance||t}function r(t,e,o){var i=!1;return t=n(t),e?(e.props.children?React.Children.forEach(e.props.children,function(e){i||(e=n(e),i=e===t?e:r(t,e,o))},this):t===e&&(i=t),i&&o.push(e),i):i}function o(t){var e=[],n=t._owner;for(r(t,n._renderedComponent,e);n._mountDepth&&n._owner;)n=n._owner,e.push(n);return e}function i(t){var e=o(t);if(e.length)for(var n in e){var r=e[n];if(r.isRouter&&r.isRouter()){var s=!1;return r.routeHasContext&&(s=r.currentRoute),s||(s=i(r)),s}}return""}function s(t,e){t=n(t);var r="";t.props.absolute||(r=i(t));var o=u(r)+"/"+t.props.route;return o=o.replace("//","/"),e||(o=u(o)),o}function a(t){return t?"*"==t.substring(t.length-1):!1}function u(t){return a(t)&&(t=t.substring(0,t.length-1)),t.length>1&&"/"==t.substring(t.length-1)&&(t=t.substring(0,t.length-1)),t}var l=React.createClass({displayName:"SwitchView",render:function(){var t=this.props.else||React.DOM.span(null),e={};React.Children.forEach(this.props.children,function(t,n){e[n]=t,t.props.id&&(e[t.props.id]=t)});var n=null;return null!==this.props.show?n=this.props.show:this.props.else||(n=0),e[n]&&(t=e[n]),React.addons.cloneWithProps(t,this.props.clientProps)}}),h=React.createClass({displayName:"Animate",getInitialState:function(){return{show:0}},componentWillMount:function(){var t=this.props.children;t.length&&(this.timer=setInterval(function(){var e=this.state.show+1;t.length<=e&&(e=0),this.setState({show:e})}.bind(this),this.props.interval||1e3))},componentWillUnmount:function(){clearInterval(this.timer)},render:function(){return l({show:this.state.show},this.props.children)}}),p=Backbone.history.loadUrl;Backbone.history.loadUrl=function(t){return t=this.fragment=this.getFragment(t),this.trigger("preroute",t),p.apply(this,arguments)};var c=React.createClass({displayName:"Router",getInitialState:function(){return{route:null,clientProps:{}}},_extractParameters:function(){return Backbone.Router.prototype._extractParameters.apply(this,arguments)},_routeToRegExp:function(){return Backbone.Router.prototype._routeToRegExp.apply(this,arguments)},isRouter:function(){return!0},handleRoute:function(t){this.currentRoute=null,t=t||Backbone.history.fragment,t="/"+t;var e=!1;React.Children.forEach(this.props.children,function(n,r){if(!e){var o=null,i={},l=!1,h=s(n);if(!h)return;if(_.isString(h)&&(o=h),_.isString(h)&&a(s(n,!0))&&(t=t.split("/").slice(0,h.split("/").length).join("/"),l=!0),t=u(t),_.isRegExp(h)||(h=this._routeToRegExp(h)),h.test(t)){if(_.isString(o)){var p=this._extractParameters(h,o),c=this._extractParameters(h,t);if(c.length>0)for(var d in c){var f=p[d];f&&(f=f.substring(1))&&(i[f]=c[d])}}}else if(""!==t||!["/",""].indexOf(o))return;this.routeIndex=r,this.routeHasContext=l,this.currentRoute=t,this.clientProps=i,e=!0}}.bind(this)),e||(this.routeIndex=null,this.routeHasContext=null,this.currentRoute=null,this.clientProps={}),this.isMounted()&&this.forceUpdate()},componentDidMount:function(){if(this.routeIndex=null,this.routeHasContext=null,this.currentRoute=null,this.clientProps={},!Backbone.History.started){var t=this.props.pushState||!1;Backbone.history.start({pushState:t})}Backbone.history.on("preroute",this.handleRoute,this),this.handleRoute()},componentWillUnmount:function(){Backbone.history.off("preroute",this.handleRoute,this)},render:function(){return l({show:this.routeIndex,clientProps:this.clientProps,"else":this.props.notFound||React.DOM.span(null)},this.props.children)}}),d=React.createClass({displayName:"Route",render:function(){return React.Children.forEach(this.props.children,function(t){for(var e in this.props)"children"!==e&&(t.props[e]=this.props[e])},this),React.DOM.span(null,this.props.children)}}),f=React.createClass({displayName:"Navigate",onClick:function(t){t.preventDefault();var e="";this.props.absolute||(e=i(this)),Backbone.history.navigate(e+this.props.href,{trigger:!0,replace:this.props.silent})},render:function(){return React.addons.cloneWithProps(React.DOM.a({onClick:this.onClick}),this.props)}}),R=React.createClass({displayName:"Loader",loading:function(){this.props.loaded=null,this.isMounted()&&this.forceUpdate()},loaded:function(){this.props.loaded=!0,this.isMounted()&&this.forceUpdate()},componentDidMount:function(){var t=this.props.model;t&&t.on&&t.off&&(t.on("request",this.loading),t.on("sync",this.loaded),t.on("error",this.loaded))},componentWillUnmount:function(){var t=this.props.model;t&&t.on&&t.off&&(t.off("request",this.loading),t.off("sync",this.loaded),t.off("error",this.loaded))},render:function(){return l({show:this.props.loaded?0:null,"else":this.props.loading},React.DOM.span(null,this.props.children))}});if(t={SwitchView:l,Animate:h,Router:c,Route:d,Navigate:f,Loader:R},e)for(var g in t)e[g]=t[g]}(Reactor,window),"undefined"!=typeof module&&module&&module.exports&&(module.exports=Reactor),"undefined"!=typeof define&&define&&define.call&&define(["Reactor"],function(t){return t});