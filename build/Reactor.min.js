var Reactor=Reactor||{};!function(t,e){function r(t){return t.__realComponentInstance||t}function n(t,e,o){var i=!1;return t=r(t),e?(e.props.children?React.Children.forEach(e.props.children,function(e){i||(e=r(e),i=e===t?e:n(t,e,o))},this):t===e&&(i=t),i&&o.push(e),i):i}function o(t){var e=[],r=t._owner;for(n(t,r._renderedComponent,e);r._mountDepth&&r._owner;)r=r._owner,e.push(r);return e}function i(t){var e=o(t);if(e.length)for(var r in e){var n=e[r];if(n.isRouter&&n.isRouter()){var s=!1;return n.routeHasContext&&(s=n.currentRoute),s||(s=i(n)),s}}return""}function s(t,e){t=r(t);var n="";t.props.absolute||(n=i(t));var o=n+t.props.route;return e||(o=u(o)),o}function a(t){return t?"*"==t.substring(t.length-1):!1}function u(t){return a(t)&&(t=t.substring(0,t.length-1)),t.length>1&&"/"==t.substring(t.length-1)&&(t=t.substring(0,t.length-1)),t}var h=React.createClass({displayName:"SwitchView",render:function(){var t=this.props.else||React.DOM.span(null),e={};React.Children.forEach(this.props.children,function(t,r){e[r]=t,t.props.id&&(e[t.props.id]=t)});var r=null;return null!==this.props.show?r=this.props.show:this.props.else||(r=0),e[r]&&(t=e[r]),React.addons.cloneWithProps(t,this.props.clientProps)}}),l=React.createClass({displayName:"Animate",getInitialState:function(){return{show:0}},componentWillMount:function(){var t=this.props.children;t.length&&(this.timer=setInterval(function(){var e=this.state.show+1;t.length<=e&&(e=0),this.setState({show:e})}.bind(this),this.props.interval||1e3))},componentWillUnmount:function(){clearInterval(this.timer)},render:function(){return h({show:this.state.show},this.props.children)}}),c=Backbone.history.loadUrl;Backbone.history.loadUrl=function(t){return t=this.fragment=this.getFragment(t),this.trigger("preroute",t),c.apply(this,arguments)};var p=React.createClass({displayName:"Router",getInitialState:function(){return{route:null,clientProps:{}}},_extractParameters:function(){return Backbone.Router.prototype._extractParameters.apply(this,arguments)},_routeToRegExp:function(){return Backbone.Router.prototype._routeToRegExp.apply(this,arguments)},isRouter:function(){return!0},handleRoute:function(t){this.currentRoute=null,t=t||Backbone.history.fragment;var e=!1;React.Children.forEach(this.props.children,function(r,n){if(!e){var o=null,i={},h=!1,l=s(r);if(!l)return;if(_.isString(l)&&(o=l),_.isString(l)&&a(s(r,!0))&&(t=t.substring(0,l.length),h=!0),t=u(t),_.isRegExp(l)||(l=this._routeToRegExp(l)),l.test(t)){if(_.isString(o)){var c=this._extractParameters(l,o),p=this._extractParameters(l,t);if(p.length>0)for(var f in p){var d=c[f];d&&(d=d.substring(1))&&(i[d]=p[f])}}}else if(""!==t||"/"!==s(r))return;this.routeIndex=n,this.routeHasContext=h,this.currentRoute=t,this.clientProps=i,e=!0}}.bind(this)),e||(this.routeIndex=null,this.routeHasContext=null,this.currentRoute=null,this.clientProps={}),this.isMounted()&&this.forceUpdate()},componentDidMount:function(){if(this.routeIndex=null,this.routeHasContext=null,this.currentRoute=null,this.clientProps={},!Backbone.History.started){var t=this.props.pushState||!1;Backbone.history.start({pushState:t})}Backbone.history.on("preroute",this.handleRoute,this),this.handleRoute()},componentWillUnmount:function(){Backbone.history.off("preroute",this.handleRoute,this)},render:function(){return h({show:this.routeIndex,clientProps:this.clientProps,"else":this.props.notFound||React.DOM.span(null)},this.props.children)}}),f=React.createClass({displayName:"Route",render:function(){return React.Children.forEach(this.props.children,function(t){for(var e in this.props)"children"!==e&&(t.props[e]=this.props[e])},this),React.DOM.span(null,this.props.children)}}),d=React.createClass({displayName:"Navigate",onClick:function(t){t.preventDefault();var e="";this.props.absolute||(e=i(this)),Backbone.history.navigate(e+this.props.href,{trigger:!0,replace:this.props.silent})},render:function(){var t=_.extend(this.props,{onClick:this.onClick});return React.addons.cloneWithProps(React.DOM.a(null),t)}});if(t={SwitchView:h,Animate:l,Router:p,Route:f,Navigate:d},e)for(var R in t)e[R]=t[R]}(Reactor,window),"undefined"!=typeof module&&module&&module.exports&&(module.exports=Reactor),"undefined"!=typeof define&&define&&define.call&&define(["Reactor"],function(t){return t});